<!--Copyright 2022 The HuggingFace Team. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
the License. You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.
-->

# ë¹„ì¡°ê±´ì (Unconditional) ì´ë¯¸ì§€ ìƒì„±

ì´ë²ˆ ë‹¨ë½ì—ì„œëŠ” ë””í“¨ì „ ëª¨ë¸ì—ê²Œ ë¹„ì¡°ê±´ì (unconditional) ì´ë¯¸ì§€ ìƒì„±ì„ í•™ìŠµì‹œí‚¤ëŠ” ë°©ë²•ì— ëŒ€í•´ ë‹¤ë¤„ë³´ë ¤ê³  í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ë¹„ì¡°ê±´ì ì´ë€ ë§ì€ ì´ë¯¸ì§€ ìƒì„±ì„ ìœ„í•œ ì–´ë– í•œ í”„ë¡¬í”„íŠ¸ë‚˜ ë¬¸ë§¥ë„ ì—†ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ë¹„ì¡°ê±´ì ìœ¼ë¡œ í›ˆë ¨ëœ ëª¨ë¸ì€ ë‹¨ìˆœíˆ í•™ìŠµ ë°ì´í„°ì˜ ë¶„í¬ì™€ ìœ ì‚¬í•œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê²Œ ë©ë‹ˆë‹¤.



## ë””íœë˜ì‹œ ì„¤ì¹˜

ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸° ì•ì„œ, ë¨¼ì € ë‹¤ìŒê³¼ ê°™ì€ ë””íœë˜ì‹œë“¤ì„ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.

```bash
pip install diffusers[training] accelerate datasets
```

ê·¸ ë‹¤ìŒ [ğŸ¤—Accelerate](https://github.com/huggingface/accelerate/) í™˜ê²½ì„ ì´ë‹ˆì…œë¼ì´ì¦ˆí•´ì•¼í•©ë‹ˆë‹¤.

```bash
accelerate config
```



## ë¹„ì¡°ê±´ì ìœ¼ë¡œ ê½ƒ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•´ë³´ê¸°

Oxford Flowers ë°ì´í„°ì…‹ì„ í†µí•´ DDPM UNet ëª¨ë¸ì„ í›ˆë ¨ì‹œì¼œë´…ì‹œë‹¤.

```bash
accelerate launch train_unconditional.py \
  --dataset_name="huggan/flowers-102-categories" \
  --resolution=64 \
  --output_dir="ddpm-ema-flowers-64" \
  --train_batch_size=16 \
  --num_epochs=100 \
  --gradient_accumulation_steps=1 \
  --learning_rate=1e-4 \
  --lr_warmup_steps=500 \
  --mixed_precision=no \
  --push_to_hub
```
í•™ìŠµëœ ëª¨ë¸ì˜ ì˜ˆì‹œ: https://huggingface.co/anton-l/ddpm-ema-flowers-64

ì „ì²´ í•™ìŠµ ì‹œê°„ì€ 4ê°œì˜ V100 GPUë¥¼ ê¸°ì¤€ìœ¼ë¡œ 2ì‹œê°„ì´ ì†Œëª¨ë©ë‹ˆë‹¤.

<img src="https://user-images.githubusercontent.com/26864830/180248660-a0b143d0-b89a-42c5-8656-2ebf6ece7e52.png" width="700" />



## ë¹„ì¡°ê±´ì ìœ¼ë¡œ í¬ì¼“ëª¬ìŠ¤í„° ì´ë¯¸ì§€ë¥¼ ìƒì„±í•´ë³´ê¸° 

ì´ë²ˆì—ëŠ” í¬ì¼“ëª¬ìŠ¤í„° ë°ì´í„°ì…‹ì„ í†µí•´ DDPM UNet ëª¨ë¸ì„ í›ˆë ¨ì‹œì¼œë´…ì‹œë‹¤.

```bash
accelerate launch train_unconditional.py \
  --dataset_name="huggan/pokemon" \
  --resolution=64 \
  --output_dir="ddpm-ema-pokemon-64" \
  --train_batch_size=16 \
  --num_epochs=100 \
  --gradient_accumulation_steps=1 \
  --learning_rate=1e-4 \
  --lr_warmup_steps=500 \
  --mixed_precision=no \
  --push_to_hub
```
í•™ìŠµëœ ëª¨ë¸ì˜ ì˜ˆì‹œ: https://huggingface.co/anton-l/ddpm-ema-pokemon-64

ë§ˆì°¬ê°€ì§€ë¡œ ì „ì²´ í•™ìŠµ ì‹œê°„ì€ 4ê°œì˜ V100 GPUë¥¼ ê¸°ì¤€ìœ¼ë¡œ 2ì‹œê°„ì´ ì†Œëª¨ë©ë‹ˆë‹¤.

<img src="https://user-images.githubusercontent.com/26864830/180248200-928953b4-db38-48db-b0c6-8b740fe6786f.png" width="700" />



## ìì²´ ë°ì´í„°ë¡œ í•´ë³´ê¸°

ìì²´ ë°ì´í„°ì…‹ì„ ê°–ê³  ë¹„ì¡°ê±´ì  ì´ë¯¸ì§€ ìƒì„±ì„ ì§„í–‰í•˜ëŠ” ë°©ë²•ì€ 2ê°€ì§€ê°€ ìˆìŠµë‹ˆë‹¤.

* í•´ë‹¹ ë°ì´í„°ì…‹ í´ë”ë¥¼ `--train_data_dir` ì¸ìë¡œ ì „ë‹¬í•˜ê±°ë‚˜,
* ë°ì´í„°ì…‹ ìì²´ë¥¼ í—ˆë¸Œì— (ë³´í†µì€ ë¹„ê³µê°œë¡œ) ì—…ë¡œë“œí•œ ë‹¤ìŒ `--dataset_name` ì¸ìë¡œ ì „ë‹¬í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

**Note**: í˜¹ì‹œ ìì²´ ë°ì´í„°ì…‹ì„ ë§Œë“¤ì–´ë³´ê³  ì‹¶ìœ¼ì‹œë‹¤ë©´, [í•´ë‹¹ ë¬¸ì„œ](https://huggingface.co/docs/datasets/image_process#image-datasets)ë¥¼ ì°¸ê³ í•´ë³´ì„¸ìš”.



### í´ë”ë¡œ ë°ì´í„°ì…‹ ì „ë‹¬í•˜ê¸°

ë§Œì•½ `--train_data_dir` í”Œë˜ê·¸ë¥¼ í†µí•´, íŠ¹ì • ë””ë ‰í† ë¦¬ë¥¼ í•™ìŠµë°ì´í„°ë¥¼ ì „ë‹¬í•˜ë©´, í•´ë‹¹ í´ë” ì•ˆì˜ ëª¨ë“  ì´ë¯¸ì§€ë“¤ì´ í•™ìŠµì— ì‚¬ìš©ë©ë‹ˆë‹¤.

```bash
data_dir/xxx.png
data_dir/xxy.png
data_dir/[...]/xxz.png
```

```bash
accelerate launch train_unconditional.py \
    --train_data_dir <path-to-train-directory> \
    <other-arguments>
```

ë‚´ë¶€ì ìœ¼ë¡œ í•´ë‹¹ ìŠ¤í¬ë¦½íŠ¸ëŠ” í´ë”ë¥¼ ğŸ¤— Dataset ì˜¤ë¸Œì íŠ¸ë¡œ ìë™ìœ¼ë¡œ ë³€í™˜í•´ì£¼ëŠ” [`ImageFolder`](https://huggingface.co/docs/datasets/v2.0.0/en/image_process#imagefolder)ë¼ëŠ” í”¼ì²˜ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.



### ë°ì´í„°ë¥¼ í—ˆë¸Œì— ì—…ë¡œë“œ í•˜ê¸° (ê°€ëŠ¥í•˜ë©´ ë¹„ê³µê°œë¡œ!)

ì—¬ëŸ¬ë¶„ì˜ ë°ì´í„°ì…‹ì„ [`ImageFolder`](https://huggingface.co/docs/datasets/v2.0.0/en/image_process#imagefolder) í”¼ì²˜ë¥¼ í†µí•´  í—ˆë¸Œì— ì—…ë¡œë“œí•˜ëŠ” ê²ƒì€ ì•„ì£¼ ê°„ë‹¨í•˜ê³  í¸ë¦¬í•©ë‹ˆë‹¤. ì•„ë˜ ì½”ë“œë¥¼ ì‹¤í–‰í•´ë´…ì‹œë‹¤.

```python
from datasets import load_dataset

# example 1: local folder
dataset = load_dataset("imagefolder", data_dir="path_to_your_folder")

# example 2: local files (supported formats are tar, gzip, zip, xz, rar, zstd)
dataset = load_dataset("imagefolder", data_files="path_to_zip_file")

# example 3: remote files (supported formats are tar, gzip, zip, xz, rar, zstd)
dataset = load_dataset(
    "imagefolder",
    data_files="https://download.microsoft.com/download/3/E/1/3E1C3F21-ECDB-4869-8368-6DEBA77B919F/kagglecatsanddogs_3367a.zip",
)

# example 4: providing several splits
dataset = load_dataset(
    "imagefolder", data_files={"train": ["path/to/file1", "path/to/file2"], "test": ["path/to/file3", "path/to/file4"]}
)
```

`ImageFolder`ëŠ” PILë¡œ ì¸ì½”ë”©ëœ ì´ë¯¸ì§€ë¥¼ í¬í•¨í•˜ëŠ” `image` ì»¬ëŸ¼ì„ ë§Œë“­ë‹ˆë‹¤.

ê·¸ ë‹¤ìŒ í—ˆë¸Œë¡œ ì—…ë¡œë“œí•˜ë©´ ë©ë‹ˆë‹¤.

```python
# assuming you have ran the huggingface-cli login command in a terminal
dataset.push_to_hub("name_of_your_dataset")

# if you want to push to a private repo, simply pass private=True:
dataset.push_to_hub("name_of_your_dataset", private=True)
```

ì´ì œ `--dataset_name` ì¸ìë¥¼ í—ˆë¸Œì— ë“±ë¡ëœ ì—¬ëŸ¬ë¶„ì˜ ë°ì´í„°ì…‹ ì´ë¦„ìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ëª¨ë¸ì„ í•™ìŠµì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë” ìì„¸í•œ ë‚´ìš©ì€ [ì´ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸](https://huggingface.co/blog/image-search-datasets)ë¥¼ ì°¸ê³ í•´ì£¼ì„¸ìš”.